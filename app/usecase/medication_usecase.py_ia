import openai
from app.schemas.status import StatusResponseSchema

from app.usecase import OPENAI_TOKEN

class MedicationUseCase:
    def __init__(self):
        openai.api_key = f'{OPENAI_TOKEN}'

    def generate_medications(self, symptoms: str) -> list[str] | StatusResponseSchema:
        try:
            prompt = f"Quais são as medicações recomendadas para os seguintes sintomas: {symptoms}?"
            response = openai.Completion.create(
                engine="text-davinci-003",
                prompt=prompt,
                max_tokens=150
            )
            medications_list = response.choices[0].text.strip().split("\n")
            return [med.strip() for med in medications_list if med.strip()]
        except Exception as error:
            return StatusResponseSchema(
                code=500,
                message="Erro ao gerar medicações.",
                details=f"{error}"
            )